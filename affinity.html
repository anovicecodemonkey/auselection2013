<!DOCTYPE html>
<!-- 
	Written by Andrew Bulhak; http://dev.null.org/acb/
	Released under a Creative Commons licence.

-->
<html>
<head>
    <title>WikiLeaks Party Senate Preference Navigator</title>
    <meta charset="utf-8">
    <style type="text/css">
    	body {
    		background-color: #fff; 
    		margin: 0px;
    		padding: 0px;
    	}
    	#header {
    		top: 0px;
    		left: 0px;
    		height: 60px;
    		margin-left: 20px
    	}
    	#header h1 {
    		font-family: helvetica, arial;
    		font-weight: bold;
    		font-size: 36px;
    		color: #416068;
    		text-shadow: -1px -1px 1px #971;
    		text-shadow: 1px 1px 0px #eee;
    	}
        #graph  { 
        	border: 1px solid #ccc;
        	background-color: #fff;
        }
        #graph text.label {
    		font-family: helvetica, arial;
        	font-size: 9px;
        }

        #sidebar {
    		font-family: helvetica, arial;
        	position: absolute;
        	left: 500px;
        	top: 84px;
        	width: 520px;
            height: 600px;
        	background-color: #eee;
        	border: 1px solid #ccc;
        	color: #7f8770;
        	text-shadow: -1px -1px 0px #ccc;
        	text-shadow: 1px 1px 0px #fff;
        	margin-left: 4px;
        	padding-left: 8px;        	
            padding-right: 4px;
        }

        #instructions {
        	position: absolute;
        	left: 12px; top: 4px;
        }


        #info h2 {
        	font-size: 18pt;
            margin-bottom: 4px;
        }

        #info h3 {
        	font-size: 14pt;
        	font-weight: normal;
        }

        #states {
            margin-top: 0px;
            font-size: 13px;        
        }

        #states span {
            color: #999;
        }
        #states span.active {
            color: #b21;
            font-weight: bold;
        }

        #prefinfo {
        	display: none;
        	position: absolute;
        	left: 0px;
        	top: 0px;
        	width: 240px;
        	height: 130px;
        	background-color: #ffffff;
        	border: 1px solid #b0b0b0;
        	border-radius: 2px;
        	color: #777;
        	box-shadow: 2px 2px 2px #ccc;
        	font-family: helvetica;
        	font-size: 10px;
        	padding: 2px;
        }
        #prefinfoname {
        	font-size: 11px;
        	font-weight: bold;
        }

        #givenpane, #rcvdpane {
        	position: relative;
        }

        .emptymsg {
        	position: absolute;
        	left: 20px;
        	right: 20px;
        	top: 45%;
        	border: 1px solid #ccc;
        	background-color: #fff;
        	opacity: 0.9;
        	padding: 6px;
        }

        #footer {
        	padding: 8px;
        	font-family: futura, helvetica, arial, sans-serif;
        	font-size: 8px;
        }
        a { color: #000;  }
    </style>
    <script src="http://d3js.org/d3.v3.min.js"></script>
</head>
<body> 
  <div id="header">
  	<h1>WikiLeaks Party Senate Preference Navigator</h1>
  </div>
  <svg id="graph" width="500" height="600" style="visibility: visible">
  </svg>
  <div id="sidebar">
	  <div id="info" style="visibility: visible">
	  	<h2 id="partyname">&nbsp;</h2>
        <div id="states">
            <span id="act">ACT</span>
            <span id="nsw" class="active">NSW</span>
            <span id="nt">NT</span>
            <span id="qld">QLD</span>
            <span id="sa">SA</span>
            <span id="tas">TAS</span>
            <span id="vic" class="active">VIC</span>
            <span id="wa" class="active">WA</span>
        </div>
	  	<div id="givenpane">
		  	<h3><b>Preferences given</b> to other parties</h3>
<svg id="pg" width="500" height="120" style="visibility: visible;">
		  	<rect x="37.23584905660377" y="11.419191919191917" width="7.2592592592592595" height="108.08080808080808" title="9.833 Animal Justice Party" style="fill: #97ab4b;"></rect><rect x="188.17924528301884" y="43.74242424242425" width="7.2592592592592595" height="75.75757575757575" title="36.500 Australia First Party" style="fill: #3b341a;"></rect><rect x="291.95283018867923" y="72.22727272727272" width="7.2592592592592595" height="47.27272727272727" title="60.000 Australian Christians" style="fill: #474ea1;"></rect><rect x="65.5377358490566" y="20.46969696969697" width="7.2592592592592595" height="99.03030303030303" title="17.300 Australian Democrats" style="fill: #8cbf53;"></rect><rect x="471.1981132075472" y="120" width="7.2592592592592595" height="0" title="999.000 Australian First Nations Party" style="fill: #d7e567;"></rect><rect x="216.4811320754717" y="51.82323232323232" width="7.2592592592592595" height="67.67676767676768" title="43.167 Australian Fishing and Lifestyle Party" style="fill: #998343;"></rect><rect x="122.14150943396228" y="32.83333333333333" width="7.2592592592592595" height="86.66666666666667" title="27.500 Australian Independents" style="fill: #778e3e;"></rect><rect x="273.08490566037733" y="66.01515151515152" width="7.2592592592592595" height="53.484848484848484" title="54.875 Australian Labor Party" style="fill: #bf0000;"></rect><rect x="207.04716981132074" y="48.99494949494951" width="7.2592592592592595" height="70.50505050505049" title="40.833 Australian Motoring Enthusiasts Party" style="fill: #999a44;"></rect><rect x="395.7264150943396" y="95.86363636363636" width="7.2592592592592595" height="23.636363636363637" title="79.500 Australian Protectionist Party" style="fill: #979944;"></rect><rect x="159.87735849056602" y="42.53030303030303" width="7.2592592592592595" height="76.96969696969697" title="35.500 Australian Republicans" style="fill: #98b450;"></rect><rect x="74.97169811320754" y="21.116161616161605" width="7.2592592592592595" height="98.3838383838384" title="17.833 Australian Sex Party" style="fill: #acb750;"></rect><rect x="8.933962264150935" y="3.7424242424242493" width="7.2592592592592595" height="115.75757575757575" title="3.500 Australian Sports Party" style="fill: #b7cf5b; stroke: #040502; stroke-width: 0px;"></rect><rect x="197.6132075471698" y="45.56060606060606" width="7.2592592592592595" height="73.93939393939394" title="38.000 Australian Voice Party" style="fill: #727433;"></rect><rect x="169.31132075471697" y="43.74242424242425" width="7.2592592592592595" height="75.75757575757575" title="36.500 Bank Reform Party" style="fill: #c3c056;"></rect><rect x="178.74528301886792" y="43.74242424242425" width="7.2592592592592595" height="75.75757575757575" title="36.500 Building Australia Party" style="fill: #989c45;"></rect><rect x="131.5754716981132" y="34.651515151515156" width="7.2592592592592595" height="84.84848484848484" title="29.000 Bullet Train for Australia" style="fill: #a9b550;"></rect><rect x="235.3490566037736" y="57.07575757575757" width="7.2592592592592595" height="62.42424242424243" title="47.500 Carers Alliance" style="fill: #a64e49;"></rect><rect x="461.76415094339626" y="119.5" width="7.2592592592592595" height="0" title="99.000 Christian Democratic Party" style="fill: #464e9f;"></rect><rect x="452.3301886792452" y="116.46969696969697" width="7.2592592592592595" height="3.0303030303030303" title="96.500 Citizens Electoral Council" style="fill: #ccc35a;"></rect><rect x="367.42452830188677" y="84.95454545454545" width="7.2592592592592595" height="34.54545454545455" title="70.500 Country Alliance" style="fill: #c45575;"></rect><rect x="480.6320754716981" y="120" width="7.2592592592592595" height="0" title="999.000 Country Liberals" style="fill: #e5df5e;"></rect><rect x="405.1603773584905" y="96.46969696969697" width="7.2592592592592595" height="23.030303030303028" title="80.000 Democratic Labour Party" style="fill: #8f5f3f;"></rect><rect x="84.40566037735849" y="21.318181818181813" width="7.2592592592592595" height="98.18181818181819" title="18.000 Drug Law Reform" style="fill: #9fc054;"></rect><rect x="310.8207547169811" y="75.25757575757575" width="7.2592592592592595" height="44.24242424242424" title="62.500 Family First" style="fill: #8d863e;"></rect><rect x="18.3679245283019" y="3.7424242424242493" width="7.2592592592592595" height="115.75757575757575" title="3.500 Future Party" style="fill: #a2c455; stroke: #030402; stroke-width: 0px;"></rect><rect x="254.21698113207546" y="57.68181818181819" width="7.2592592592592595" height="61.81818181818181" title="48.000 Greens" style="fill: #00bf00;"></rect><rect x="56.10377358490567" y="19.095959595959613" width="7.2592592592592595" height="100.40404040404039" title="16.167 Help End Marijuana Prohibition" style="fill: #b9be53;"></rect><rect x="386.29245283018867" y="92.34848484848484" width="7.2592592592592595" height="27.15151515151516" title="76.600 Independent" style="fill: #d7e567;"></rect><rect x="301.38679245283015" y="73.23737373737374" width="7.2592592592592595" height="46.262626262626256" title="60.833 Katter's Australian Party" style="fill: #948842;"></rect><rect x="46.66981132075472" y="18.287878787878782" width="7.2592592592592595" height="101.21212121212122" title="15.500 Liberal Democratic Party" style="fill: #a7a74a;"></rect><rect x="490.0660377358491" y="120" width="7.2592592592592595" height="0" title="999.000 Liberal National Party" style="fill: #5055c0;"></rect><rect x="282.5188679245283" y="70.26923076923077" width="7.2592592592592595" height="49.230769230769226" title="58.385 Liberal Party" style="fill: #0000bf;"></rect><rect x="225.91509433962264" y="56.71212121212122" width="7.2592592592592595" height="62.78787878787878" title="47.200 National Party" style="fill: #545d11;"></rect><rect x="499.5" y="120" width="7.2592592592592595" height="0" title="999.000 Nick Xenophon Group" style="fill: #d0c35b;"></rect><rect x="414.5943396226415" y="97.07575757575758" width="7.2592592592592595" height="22.424242424242426" title="80.500 No Carbon Tax Climate Sceptics" style="fill: #89873c;"></rect><rect x="263.6509433962264" y="64.34848484848484" width="7.2592592592592595" height="55.151515151515156" title="53.500 Non-Custodial Parents Party (Equal Parenting)" style="fill: #4b4b21;"></rect><rect x="442.8962264150943" y="108.18686868686869" width="7.2592592592592595" height="11.313131313131306" title="89.667 One Nation" style="fill: #43451e;"></rect><rect x="376.8584905660377" y="88.18686868686869" width="7.2592592592592595" height="31.31313131313131" title="73.167 Outdoor Recreation Party (Stop the Greens)" style="fill: #a8a64a;"></rect><rect x="357.99056603773585" y="83.82900432900433" width="7.2592592592592595" height="35.67099567099567" title="69.571 Palmer United Party" style="fill: #5fb750;"></rect><rect x="27.80188679245282" y="5.560606060606062" width="7.2592592592592595" height="113.93939393939394" title="5.000 Pirate Party" style="fill: #65c150; stroke: #65c150; stroke-width: 0px;"></rect><rect x="433.4622641509434" y="102.32828282828282" width="7.2592592592592595" height="17.171717171717177" title="84.833 Rise Up Australia" style="fill: #9a4562;"></rect><rect x="244.78301886792454" y="57.479797979797986" width="7.2592592592592595" height="62.020202020202014" title="47.833 Secular Party of Australia" style="fill: #8ebe51;"></rect><rect x="150.44339622641508" y="39.257575757575765" width="7.2592592592592595" height="80.24242424242424" title="32.800 Senator OnLine" style="fill: #959b44;"></rect><rect x="348.55660377358487" y="79.29797979797979" width="7.2592592592592595" height="40.20202020202021" title="65.833 Shooters and Fishers" style="fill: #988643;"></rect><rect x="329.688679245283" y="77.68181818181819" width="7.2592592592592595" height="41.81818181818182" title="64.500 Smokers Rights" style="fill: #a7a74a;"></rect><rect x="424.0283018867924" y="98.28787878787878" width="7.2592592592592595" height="21.21212121212121" title="81.500 Socialist Alliance" style="fill: #c46551;"></rect><rect x="141.00943396226415" y="36.46969696969697" width="7.2592592592592595" height="83.03030303030303" title="30.500 Socialist Equality Party" style="fill: #ae5f4d;"></rect><rect x="320.25471698113205" y="75.25757575757575" width="7.2592592592592595" height="44.24242424242424" title="62.500 Stable Population Party" style="fill: #acb650;"></rect><rect x="93.83962264150944" y="21.318181818181813" width="7.2592592592592595" height="98.18181818181819" title="18.000 Stop CSG" style="fill: #9ab44e;"></rect><rect x="-0.5" y="1.577922077922068" width="7.2592592592592595" height="117.92207792207793" title="1.714 The Wikileaks Party" style="fill: #f37321;"></rect><rect x="103.27358490566036" y="23.13636363636364" width="7.2592592592592595" height="96.36363636363636" title="19.500 Uniting Australia Party" style="fill: #adb04d;"></rect><rect x="112.70754716981133" y="25.560606060606062" width="7.2592592592592595" height="93.93939393939394" title="21.500 Voluntary Euthanasia Party" style="fill: #75b04c;"></rect><rect x="339.12264150943395" y="78.16666666666667" width="7.2592592592592595" height="41.33333333333333" title="64.900 _" style="fill: #d7e567;"></rect>
		  	</svg>
		  	<div class="emptymsg" style="visibility: hidden"><span id="givenname">This group</span> did not give any preferences.</div>
	    </div>
	    <div id="rcvdpane">
		  	<h3><b>Preferences received</b> from other parties</h3>
<svg id="pr" width="500" height="120" style="visibility: visible;">
		  	<rect x="137.4310344827586" y="24.400239425379084" width="6.474576271186441" height="95.09976057462092" title="18.571 Animal Justice Party" style="fill: #97ab4b;"></rect><rect x="249.5" y="48.438547486033514" width="6.474576271186441" height="71.06145251396649" title="36.500 Australia First Party" style="fill: #3b341a;"></rect><rect x="378.81034482758616" y="87.18715083798884" width="6.474576271186441" height="32.31284916201117" title="65.400 Australian Christians" style="fill: #474ea1;"></rect><rect x="154.67241379310346" y="33.40263367916998" width="6.474576271186441" height="86.09736632083002" title="25.286 Australian Democrats" style="fill: #8cbf53;"></rect><rect x="413.2931034482759" y="101.78252194732643" width="6.474576271186441" height="17.717478052673574" title="76.286 Australian Fishing and Lifestyle Party" style="fill: #998343;"></rect><rect x="283.98275862068965" y="53.51436552274541" width="6.474576271186441" height="65.98563447725459" title="40.286 Australian Independents" style="fill: #778e3e;"></rect><rect x="163.29310344827584" y="33.977254588986426" width="6.474576271186441" height="85.52274541101357" title="25.714 Australian Labor Party" style="fill: #bf0000;"></rect><rect x="275.3620689655172" y="52.79608938547486" width="6.474576271186441" height="66.70391061452514" title="39.750 Australian Motoring Enthusiasts Party" style="fill: #999a44;"></rect><rect x="344.32758620689657" y="76.5949720670391" width="6.474576271186441" height="42.9050279329609" title="57.500 Australian Protectionist Party" style="fill: #979944;"></rect><rect x="327.0862068965517" y="72.57262569832403" width="6.474576271186441" height="46.927374301675975" title="54.500 Australian Republicans" style="fill: #98b450;"></rect><rect x="94.32758620689654" y="14.057063048683176" width="6.474576271186441" height="105.44293695131682" title="10.857 Australian Sex Party" style="fill: #acb750;"></rect><rect x="8.120689655172413" y="4.192737430167597" width="6.474576271186441" height="115.3072625698324" title="3.500 Australian Sports Party" style="fill: #b7cf5b;"></rect><rect x="240.87931034482756" y="47.38507581803671" width="6.474576271186441" height="72.11492418196329" title="35.714 Australian Voice Party" style="fill: #727433;"></rect><rect x="309.8448275862069" y="63.857541899441344" width="6.474576271186441" height="55.64245810055866" title="48.000 Bank Reform Party" style="fill: #c3c056;"></rect><rect x="301.2241379310345" y="61.444134078212294" width="6.474576271186441" height="58.055865921787706" title="46.200 Building Australia Party" style="fill: #989c45;"></rect><rect x="352.94827586206895" y="78.06983240223464" width="6.474576271186441" height="41.43016759776536" title="58.600 Bullet Train for Australia" style="fill: #a9b550;"></rect><rect x="120.18965517241378" y="21.62290502793296" width="6.474576271186441" height="97.87709497206704" title="16.500 Carers Alliance" style="fill: #a64e49;"></rect><rect x="387.4310344827586" y="91.34357541899442" width="6.474576271186441" height="28.156424581005588" title="68.500 Christian Democratic Party" style="fill: #464e9f;"></rect><rect x="42.603448275862064" y="10.22625698324022" width="6.474576271186441" height="109.27374301675978" title="8.000 Citizens Electoral Council" style="fill: #ccc35a;"></rect><rect x="439.155172413793" y="117.48882681564245" width="6.474576271186441" height="2.011173184357542" title="88.000 Country Alliance" style="fill: #c45575;"></rect><rect x="456.3965517241379" y="120" width="6.474576271186441" height="0" title="999.000 Country Liberals" style="fill: #e5df5e;"></rect><rect x="430.53448275862064" y="108.10335195530726" width="6.474576271186441" height="11.396648044692737" title="81.000 Democratic Labour Party" style="fill: #8f5f3f;"></rect><rect x="180.5344827586207" y="37.87988826815642" width="6.474576271186441" height="81.62011173184358" title="28.625 Drug Law Reform" style="fill: #9fc054;"></rect><rect x="318.4655172413793" y="66.5391061452514" width="6.474576271186441" height="52.9608938547486" title="50.000 Family First" style="fill: #8d863e;"></rect><rect x="16.741379310344826" y="4.192737430167597" width="6.474576271186441" height="115.3072625698324" title="3.500 Future Party" style="fill: #a2c455;"></rect><rect x="33.98275862068965" y="9.46009577015164" width="6.474576271186441" height="110.03990422984836" title="7.429 Greens" style="fill: #00bf00; stroke: #000300; stroke-width: 0px;"></rect><rect x="370.18965517241384" y="81.95810055865923" width="6.474576271186441" height="37.54189944134078" title="61.500 Group AG" style="fill: #c48f55;"></rect><rect x="206.39655172413794" y="44.63966480446926" width="6.474576271186441" height="74.86033519553074" title="33.667 Group AJ" style="fill: #a9c156;"></rect><rect x="465.01724137931035" y="120" width="6.474576271186441" height="0" title="999.000 Group C" style="fill: #a3ac49;"></rect><rect x="215.01724137931032" y="45.75698324022346" width="6.474576271186441" height="73.74301675977654" title="34.500 Group F" style="fill: #b2c455;"></rect><rect x="473.6379310344828" y="120" width="6.474576271186441" height="0" title="999.000 Group I" style="fill: #67d154;"></rect><rect x="482.2586206896551" y="120" width="6.474576271186441" height="0" title="999.000 Group L" style="fill: #9dce5a;"></rect><rect x="25.36206896551724" y="4.8631284916201025" width="6.474576271186441" height="114.6368715083799" title="4.000 Group T" style="fill: #88d157;"></rect><rect x="490.87931034482756" y="120" width="6.474576271186441" height="0" title="999.000 Group U" style="fill: #8ebc4c;"></rect><rect x="197.77586206896552" y="44.29789681235623" width="6.474576271186441" height="75.20210318764377" title="33.412 Help End Marijuana Prohibition" style="fill: #b9be53;"></rect><rect x="266.7413793103448" y="49.875099760574614" width="6.474576271186441" height="69.62490023942539" title="37.571 Katter's Australian Party" style="fill: #948842;"></rect><rect x="77.08620689655174" y="13.578212290502805" width="6.474576271186441" height="105.9217877094972" title="10.500 Liberal Democratic Party" style="fill: #a7a74a;"></rect><rect x="421.9137931034483" y="104.91899441340782" width="6.474576271186441" height="14.581005586592179" title="78.625 Liberal National Party" style="fill: #5055c0;"></rect><rect x="335.7068965517241" y="73.91340782122904" width="6.474576271186441" height="45.58659217877095" title="55.500 Liberal Party" style="fill: #0000bf;"></rect><rect x="51.22413793103448" y="12.237430167597779" width="6.474576271186441" height="107.26256983240222" title="9.500 National Party" style="fill: #545d11;"></rect><rect x="499.5" y="120" width="6.474576271186441" height="0" title="999.000 Nick Xenophon Group" style="fill: #d0c35b;"></rect><rect x="258.12068965517244" y="48.917398244213885" width="6.474576271186441" height="70.58260175578611" title="36.857 No Carbon Tax Climate Sceptics" style="fill: #89873c;"></rect><rect x="223.63793103448276" y="45.75698324022346" width="6.474576271186441" height="73.74301675977654" title="34.500 Non-Custodial Parents Party (Equal Parenting)" style="fill: #4b4b21;"></rect><rect x="447.7758620689655" y="119.5" width="6.474576271186441" height="0" title="89.500 One Nation" style="fill: #43451e;"></rect><rect x="111.5689655172414" y="14.91899441340783" width="6.474576271186441" height="104.58100558659217" title="11.500 Outdoor Recreation Party (Stop the Greens)" style="fill: #a8a64a;"></rect><rect x="189.15517241379308" y="40.298084596967286" width="6.474576271186441" height="79.20191540303271" title="30.429 Palmer United Party" style="fill: #5fb750;"></rect><rect x="59.84482758620686" y="12.639664804469277" width="6.474576271186441" height="106.86033519553072" title="9.800 Pirate Party" style="fill: #65c150;"></rect><rect x="396.05172413793105" y="96.22785315243415" width="6.474576271186441" height="23.27214684756585" title="72.143 Rise Up Australia" style="fill: #9a4562;"></rect><rect x="85.70689655172413" y="13.673982442138865" width="6.474576271186441" height="105.82601755786114" title="10.571 Secular Party of Australia" style="fill: #8ebe51;"></rect><rect x="292.60344827586204" y="58.22625698324021" width="6.474576271186441" height="61.27374301675979" title="43.800 Senator OnLine" style="fill: #959b44;"></rect><rect x="404.67241379310343" y="101.78252194732643" width="6.474576271186441" height="17.717478052673574" title="76.286 Shooters and Fishers" style="fill: #988643;"></rect><rect x="102.94827586206895" y="14.91899441340783" width="6.474576271186441" height="104.58100558659217" title="11.500 Smokers Rights" style="fill: #a7a74a;"></rect><rect x="68.4655172413793" y="13.578212290502805" width="6.474576271186441" height="105.9217877094972" title="10.500 Socialist Alliance" style="fill: #c46551; stroke: #21110e; stroke-width: 0px;"></rect><rect x="361.5689655172414" y="78.66999201915404" width="6.474576271186441" height="40.83000798084596" title="59.048 Socialist Equality Party" style="fill: #ae5f4d;"></rect><rect x="232.25862068965517" y="46.61891460494813" width="6.474576271186441" height="72.88108539505187" title="35.143 Stable Population Party" style="fill: #acb650;"></rect><rect x="128.81034482758622" y="23.902234636871512" width="6.474576271186441" height="95.59776536312849" title="18.200 Stop CSG" style="fill: #9ab44e;"></rect><rect x="-0.5" y="1.7984836392657542" width="6.474576271186441" height="117.70151636073425" title="1.714 The Wikileaks Party" style="fill: #f37321;"></rect><rect x="146.05172413793105" y="26.986033519553075" width="6.474576271186441" height="92.51396648044692" title="20.500 Uniting Australia Party" style="fill: #adb04d;"></rect><rect x="171.91379310344826" y="37.71229050279331" width="6.474576271186441" height="81.78770949720669" title="28.500 Voluntary Euthanasia Party" style="fill: #75b04c;"></rect>
		  	</svg>
		  	<div class="emptymsg" style="visibility: hidden">No other parties gave preferences to <span id="rcvdname">this party</span>.</div>
		</div>
        <p><b>Preference buddies:</b> 
        <span id="buddies"><span style="color:#b7cf5b">Australian Sports Party</span>, <span style="color:#a2c455">Future Party</span>, <span style="color:#65c150">Pirate Party</span>, <span style="color:#97ab4b">Animal Justice Party</span></span>        </p>
        <p><b>Adversaries:</b>
        <span id="nemeses"><span style="color:#464e9f">Christian Democratic Party</span>, <span style="color:#ccc35a">Citizens Electoral Council</span>, <span style="color:#43451e">One Nation</span>, <span style="color:#9a4562">Rise Up Australia</span></span>
        </p>
	  </div>
	  <div id="instructions" style="visibility: hidden">
	  	<p>The circles represent political parties or tickets giving or receiving preferences for the Senate in the 2013 Federal Election. Circles which preference each other more highly are (more or less) closer together.</p>
	  	<p>Click on a circle to see whom that party gives preferences to and receives preferences from.</p>

	  </div>

	</div>
  <div id="footer">
  	Visualisation coded by <a href="http://dev.null.org/acb/">acb</a>, using <a href="http://d3js.org">D3</a> and a bit of <a href="http://python.org">Python</a>. Data from <a href="http://www.abc.net.au/news/federal-election-2013/guide/gtv/">ABC Vote Compass</a>.
  </div>
	<div id="prefinfo">
		<div id="prefinfoname">&nbsp;</div>
		<p>Average preference given to <span id="prefinforel">-</span>: <span id="prefinfogiven">-</span></p>
		<p>Average preference received from <span id="prefinforel2">-</span>: <span id="prefinforcvd">-</span></p>
        <p>Buddies with: <span id="prefinfobuddies"></span></p>
	</div>
     <script>
    var avgpref = null;
    var party_colours = {};

    var abbrev = {
      "Christian Democratic Party": "CDP", "Rise Up Australia": "RsUp",  "Bank Reform Party": "BkRf", 
      "Drug Law Reform": "DrgL",  "Australian Sex Party": "Sex",  "Carers Alliance": "Crrs",  
      "Country Alliance": "CtrA", "Australian Christians": "AXtn",  "National Party": "NAT", 
      "Stop CSG": "!CSG",  "Socialist Alliance": "SocA",  "Liberal National Party": "LNP", 
      "Outdoor Recreation Party (Stop the Greens)": "AntG",  "Non-Custodial Parents Party (Equal Parenting)": "NCPP", 
      "Shooters and Fishers": "ShFi",  "Voluntary Euthanasia Party": "Euth",  "Australian Sports Party": "Sprt", 
      "Group I": "GrpI",   "Group F": "GrpF",  "Senator OnLine": "Onln",  "Australian Independents": "AInd",  "Smokers Rights": "Smke", 
      "Australian Fishing and Lifestyle Party": "Fish", "Australian Motoring Enthusiasts Party": "Ptrl", 
      "Building Australia Party": "Buil",  "Australian Labor Party": "ALP",   "Socialist Equality Party": "Soc=", 
      "Group AG": "G_AG",  "Group AJ": "G_AJ",   "Group U": "G_U",  "Help End Marijuana Prohibition": "HEMP", 
      "Democratic Labour Party": "DLP",   "Nick Xenophon Group": "Xeno",   "Palmer United Party": "Plmr", 
      "Group C": "G_C",   "Pirate Party": "PPAU",  "Greens": "GRN",   "Group T": "G_T",   "Future Party": "Futr", 
      "Uniting Australia Party": "Unit",   "Group L": "G_L",   "No Carbon Tax Climate Sceptics": "Crbn", 
      "Liberal Party": "LIB",  "The Wikileaks Party": "WikiLeaks Party",   "Family First": "FF",   "Australian Democrats": "DEM", 
      "Australian Protectionist Party": "Prot",   "Stable Population Party": "Popn",   "Country Liberals": "CLP", 
      "Australian Republicans": "Repb",   "Bullet Train for Australia": "BTrn",   "Australian Voice Party": "Voic", 
      "Australia First Party" : "AF",
      "Australian First Nations Party": "AFNP",   "A.F.N.P.P.": "AFNP",   "Secular Party of Australia": "Secu", 
      "Katter's Australian Party": "Katr",   "One Nation": "OneN",   "Liberal Democratic Party": "LDP",   
      "Citizens Electoral Council": "CEC", "Animal Justice Party": "Anim", "_":"-", "Independent":"IND",

    };

     function partyColour(party) {
        return party_colours[party] || '#ccc';
     };

     // return a list of N parties most 
     function getbuddies(party, count) {
        var d = d3.set([]), gi=0, nm, got=0;
        var given = avgpref.given[party];
        if(!given) return [];
        while(got < count) {
            nm = given[gi++].name;
            if(nm !== party && !d.has(nm)) { 
                d.add(nm);
                got += 1;
            }
        }
        return d.values();
     };
     // return a list of N parties most 
     function getfoes(party, count) {
        var d = d3.set([]), nm, got=0;
        var given = avgpref.given[party], gi=given ? given.length-1 : 0;
        if(!given) return [];
        while(got < count) {
            nm = given[gi--].name;
            if(nm !== party && !d.has(nm)) { 
                d.add(nm);
                got += 1;
            }
        }
        return d.values();
     };

     // the current preference relationship: party name -> pref
     var curgiven = {}, currcvd = {};

     /* Load a default party on load */
        function loadedDefault() {
        d3.select('#info').select('h2').text('The Wikileaks Party');
      };

        window.onload = loadedDefault();

     /* called when a party has been selected */
     function selected(name) {
        var i;
        if(!avgpref) return;
        var given = avgpref.given[name], rcvd = avgpref.received[name], states = avgpref.states[name];
        d3.select('#instructions').style('visibility', 'hidden');
        d3.select('#info').style('visibility', 'visible');
        d3.select('#info').select('h2').text(name);
        d3.select('#prefinforel').text(name);
        d3.select('#prefinforel2').text(name);
        d3.select('#givenname').text(name);
        d3.select('#rcvdname').text(name);

        d3.select('#givenpane svg').style('visibility', given ? 'visible' : 'hidden');
        d3.select('#rcvdpane svg').style('visibility', rcvd ? 'visible' : 'hidden');
        d3.select('#givenpane .emptymsg').style('visibility', given ? 'hidden' : 'visible');
        d3.select('#rcvdpane .emptymsg').style('visibility', rcvd ? 'hidden' : 'visible');

        d3.select('#states').selectAll('span').attr('class','');
        if(states) {
            for (i = 0; i < states.length; i += 1) {
                d3.select('#'+states[i]).attr('class','active');
            }
        }

        if(given) { given.forEach(function(d) {curgiven[d.name] = d.pref;}); }
        if(rcvd) { rcvd.forEach(function(d) {currcvd[d.name] = d.pref;}); }

        prefCharts.given.updateData(avgpref.given[name]);
        prefCharts.received.updateData(avgpref.received[name]);

        d3.select('#buddies').html(getbuddies(name,4).map(function(n){return '<span style="color:'+partyColour(n)+'">'+n+'</span>';}).join(", "));
        d3.select('#nemeses').html(getfoes(name,4).map(function(n){return '<span style="color:'+partyColour(n)+'">'+n+'</span>';}).join(", "));
     };

     function draw(data) {
        "use strict";

        var width = 500, height = 600;

        // set initial positions
        for(var i = 0; i < data.nodes.length; i += 1) {
            party_colours[data.nodes[i].name] = data.nodes[i].colour;
            if(data.nodes[i].name == 'The Wikileaks Party') {
                data.nodes[i].x = 250;
                data.nodes[i].y = 300;
            }
             else {
                data.nodes[i].x = 250;
                data.nodes[i].y = 300;
            }
        }
        var svg = d3.select('svg#graph');
        svg.append('circle')
            .attr('id', 'halo')
            .style('fill', '#ffffff')
            .attr('cx',100)
            .attr('cy',100)
            .attr('r','12');

        var node = svg.selectAll("g.node") .data(data.nodes)
            .enter()
            .append('g')
            .attr("class", "node") ;

        node.append("circle")
            .attr('class', 'node')
            .attr('cx',0)
            .attr('cy',0)
            .attr("r", 5)
            .style('fill', function(n,i){return n.colour;})
            .attr('title', function(n){return n.name;})
            .attr('stroke','#ffffff')
            .attr('stroke-width', 0)
            .on('click', function(n){selected(n.name)});
        node.append("text")
            .attr('class','label')
            .attr("dx", 8)
            .attr("dy", ".35em")
            .text(function(d) { return abbrev[d.name]; });

        svg.selectAll('circle.node')
            .on('mouseover', function(d) {
                d3.select(this).transition().attr('r',7);
            })
            .on('mouseout', function(d) {
                d3.select(this).transition().attr('r',5);
            });

        var force = d3.layout.force() .charge(-120)
            .linkDistance(function(l){return 4.0/l.value;})
            .size([width, height]) .nodes(data.nodes) .links(data.links) .start();
        force.on("tick", function() {
            node.attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });
            });
        node.call(force.drag);
        };

    var fmt_pref = d3.format("2.3f");

    function PrefChartObject(svgSelector, parties) {
    	parties = parties.map(function(name){return {name:name, pref:0}});
    	this.parties = parties;
    	this.svg = d3.select(svgSelector);
		this.x_scale = d3.scale.linear() 
					.range([0,500]) .domain([0,parties.length-1]);
		this.y_scale = d3.scale.linear()
					.range([0, 120])
					.domain([0, 1]);
		var self = this;
		// party -> x offset mapping
		self.xpos = {};
     	for(var i=0; i<parties.length; i++) {
     		this.xpos[parties[i].name] = self.x_scale(i);
     	}

     	this.svg.selectAll("rect")
     		.data(parties, function(d){return d.name;})
     	.enter()
     	.append("rect")
     		.attr("x", function(d, i) { return self.x_scale(i) - .5; })
     		.attr("y", function(d) { return 120; })
     		.attr("width", (500/parties.length)-2)
     		.attr("height", function(d) { return 0; })
     		.style('fill', function(d) { return partyColour(d.name); })
     		.attr("title", function(d) { return d.name; })
     		.on("mouseover", function(d, i) {
				var cr = self.svg[0][0].getBoundingClientRect();
                var doc = document.documentElement, body = document.body;
                var scroll = (doc && doc.scrollTop  || body && body.scrollTop  || 0)
     			d3.select(this).transition().style('stroke-width', 4).style('stroke', partyColour(d.name));
     			var infobox = d3.select("#prefinfo");
     			d3.select('#prefinfoname').text(d.name);
     			d3.select('#prefinfogiven').text(fmt_pref(curgiven[d.name]));
     			d3.select('#prefinforcvd').text(fmt_pref(currcvd[d.name]));
                d3.select('#prefinfobuddies').text(getbuddies(d.name,3).join(", "));
     			infobox.style('display', 'block')
     					.style("left", (cr.left +Math.max(0,Math.min(160,( self.xpos[d.name]-120)))) + 'px')
     				   .style("top", (cr.bottom + 4 + scroll ) + 'px');
     		})
     		.on("mouseout", function(d) {
     			d3.select(this).transition().style('stroke-width', 0);
     			var infobox = d3.select("#prefinfo");
     			infobox.style('display', 'none');
     		});
    };
    PrefChartObject.prototype.updateData = function(dataIn) {
    	var data = dataIn ? dataIn.map(function(v){return v;}) : [];
     	var provided = d3.set(data.map(function(v){return v.name;}));
		var y_extent = d3.extent(data, function(d){return d.pref;});
		var self = this;
     	for(var i=0; i<this.parties.length; i++) {
     		if(!provided.has(this.parties[i].name)) {
     			data.push({name:this.parties[i].name, pref:999});
     		}
     	}
     	for(var i=0; i<data.length; i++) {
     		this.xpos[data[i].name] = self.x_scale(i);
     	}
     	this.svg.selectAll("rect")
     		.data(data, function(d){return d.name;})
     	.transition().duration(300)
     		.attr("x", function(d, i) { return self.x_scale(i) - .5; })
     		.attr("y", function(d) { return (d.pref===999)? 120 :120 - self.y_scale((y_extent[1]-d.pref)/y_extent[1]) - .5; })
     		.attr("height", function(d) { return (d.pref===999)? 0 : self.y_scale((y_extent[1]-d.pref)/y_extent[1]); })
     		.style('fill', function(d) { return partyColour(d.name); })
     		.attr("title", function(d) { return fmt_pref(d.pref) + " " + d.name; });
    };

	var prefCharts = { given : null, received : null };

    function decodeprefdict(data, partylist) {
        var r = {}, k, l, rl, i;
        for (k in data) {
            if (data.hasOwnProperty(k)) {
                l = data[k];
                rl = [];
                for (i = 0; i < l.length; i += 1) {
                    rl.push( { name:partylist[l[i].i], pref:l[i].p} );
                }
                r[partylist[k]] = rl;
            }
        }
        return r;
    }

    function decodestates(data, partylist) {
        var states = ["nsw", "vic", "qld", "wa", "sa", "tas", "act", "nt"];
        var r = {}, k, l, s, i;
        for (k in data) {
            if (data.hasOwnProperty(k)) {
                l = [];
                s = data[k].split('');
                for( i = 0; i < s.length; i += 1) {
                    l.push(states[s[i]]);
                }
                r[partylist[k]] = l;
            }
        } 
        return r;       
    }

    d3.json("prefdata.json", function(data) { 
//    	avgpref = data; 
        avgpref = {};
        avgpref.given = decodeprefdict(data.g, data.p);
        avgpref.received = decodeprefdict(data.r, data.p);
        avgpref.states = decodestates(data.s, data.p);
    	d3.select('#graph').style('visibility', 'visible');
    	// fill given/received charts with initial data
    	prefCharts.given = new PrefChartObject('svg#pg', d3.keys(avgpref.received));
    	prefCharts.received = new PrefChartObject('svg#pr', d3.keys(avgpref.given));
    });
    d3.json("fdg.json", draw);
  </script>
 </body></html>
